(* 1.1 Turn a string into a list of characters. *)
let string_explode (s : string) : char list =
  let n = String.length s in
  let rec tabulate f n =
    if n < 0 then [] else tabulate f (n-1) @ [f n]
  in
  tabulate (String.get s) (n-1)

(* 1.2 Turn a list of characters into a string. *)
let string_implode (l : char list) : string =
  List.fold_left (fun acc c -> acc ^ Char.escaped c) "" l

(* ------------------------------------------------------------------------*)
(* Q2 : Bank Account *)
(* ------------------------------------------------------------------------*)

let open_account (pass: password) : bank_account =
  let stored_pass = ref pass in
  let balance = ref 0 in
  
  let update_pass old_pass new_pass =
    if !stored_pass = old_pass then
      stored_pass := new_pass
    else
      raise wrong_pass
  in
  
  let retrieve p amount =
    if !stored_pass <> p then
      raise wrong_pass
    else if amount < 0 then
      raise negative_amount
    else if amount > !balance then
      raise not_enough_balance
    else
      balance := !balance - amount
  in
  
  let deposit p amount =
    if !stored_pass <> p then
      raise wrong_pass
    else if amount < 0 then
      raise negative_amount
    else
      balance := !balance + amount
  in
  
  let show_balance p =
    if !stored_pass <> p then
      raise wrong_pass
    else
      !balance
  in
  
  { update_pass; retrieve; deposit; show_balance }
;;